<!DOCTYPE html>
<html lang=en-US>
<head>
<meta charset=utf-8>
<title>Linux command dpkg-fsys-usrunmess</title><meta name="description" content="Linux command dpkg-fsys-usrunmess undoes the merged-/usr-via-aliased-dirs mess"><meta name="keywords" content="linux, command, dpkg-fsys-usrunmess, bsd, undoes the merged-/usr-via-aliased-dirs mess"><meta name="robots" content="index,follow">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="container">

<pre><code></code></pre>
<p><br />
</p>
<h1>NAME</h1>
<p>dpkg-fsys-usrunmess - undoes the merged-/usr-via-aliased-dirs mess</p>
<h1>SYNOPSIS</h1>
<p><strong>dpkg-fsys-usrunmess</strong> [<strong>option</strong>...]</p>
<h1>DESCRIPTION</h1>
<p><strong>dpkg-fsys-usrunmess</strong> is a tool to fix up filesystems that have been installed anew with recent installers with unfortunate defaults or migrated to the broken merged /usr via aliased directories layout, which is <strong>not</strong> supported by dpkg. See the dpkg FAQ.</p>
<p>The program will perform the following overall actions:</p>
<ul>
<li><p>Check whether the system needs to be switched, otherwise do nothing,</p></li>
<li><p>Check for dpkg database consistency and otherwise abort.</p></li>
<li><p>Get the list of files and alternatives that need to be restored.</p></li>
<li><p>Create a shadow hierarchy under <em>/.usrunmess</em>, by creating the directories symlinks or hardlinking or copying the files as needed.</p></li>
<li><p>Prompt for confirmation before proceeding, if requested on the command-line.</p></li>
<li><p>Lock the dpkg database.</p></li>
<li><p>Mark all packages as half-configured to force running maintainer scripts that might need to recreate files.</p></li>
<li><p>Replace the aliased directories with the shadow ones, by creating a backup of the old symlinked directories and renaming the shadow ones over.</p></li>
<li><p>Relabel MAC information for directories and symlinks if necessary.</p></li>
<li><p>Reconfigure all packages.</p></li>
<li><p>Remove backup symlinks.</p></li>
<li><p>Remove old moved objects, but defer directory removal.</p></li>
<li><p>Remove old deferred directories that are not referenced by dpkg-query.</p></li>
<li><p>Remove shadow root directory.</p></li>
</ul>
<p><strong>Note</strong>: When running the program from some shells such as <strong>bash</strong> (1) or <strong>zsh</strong> (1), after executing it, you might need to request the shell to forget all remembered executable locations with for example <code>hash -r</code>.</p>
<p><strong>Warning</strong>: Note that this operation has the potential to render the system unusable or broken in case of a sudden crash or reboot, unexpected state of the system, or possible bugs in the script. Be prepared with recovery media and consider doing backups beforehand.</p>
<h1>OPTIONS</h1>
<ul>
<li><p>Prompt at the time of no return, so that the debug output or the shadow hierarchy can be evaluated before proceeding.</p></li>
<li></li>
</ul>
<ul>
<li></li>
</ul>
<p>This option enables the dry-run mode, where no destructive action takes place, only the preparatory part.</p>
<ul>
<li><p>Show the usage message and exit.</p></li>
<li><p>Show the version and exit.</p></li>
</ul>
<h1>ENVIRONMENT</h1>
<ul>
<li><p>This setting defines whether to enable dry-run mode.</p></li>
</ul>
<h1>SEE ALSO</h1>
<p>&lt;https://wiki.debian.org/Teams/Dpkg/FAQ#Q:_Does_dpkg_support_merged-.2Fusr-via-aliased-dirs.3F&gt;.</p>
<footer style="text-align: center;"><a href="https://blog.tamer.pw" target="_blank">Blog</a> | <a href="https://github.com/linuxtamer" target="_blank">Contact</a></footer>
</div>
</body>
</html>

